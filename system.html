<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Architecture | Powderchest</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js?v=2"></script>
    <script>
        mermaid.initialize({ 
            startOnLoad: true, 
            theme: 'dark',
            themeVariables: {
                fontSize: '40px',
                fontFamily: 'Inter, sans-serif',
                primaryColor: '#1a1a2e',
                primaryTextColor: '#ffffff',
                primaryBorderColor: '#d4af37',
                secondaryColor: '#16213e',
                tertiaryColor: '#0f3460',
                clusterBkg: '#071932',
                clusterBorder: '#d4af37'
            },
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                nodeSpacing: 200,
                rankSpacing: 250,
                padding: 100,
                curve: 'basis'
            }
        });
    </script>
    <style>
    /* KEEP THESE: Global Page Layout */
    .system-page {
        max-width: 100%;
        margin: 0 auto;
        padding: 2rem 1rem;
    }
    nav { margin-bottom: 2rem; }
    nav a {
        color: #d4af37;
        text-decoration: none;
        font-size: 1.1rem;
        transition: opacity 0.3s;
    }
    nav a:hover { opacity: 0.7; }
    h1 {
        font-family: 'PirateFont', Georgia, serif;
        font-size: clamp(2rem, 5vw, 3.5rem);
        color: #d4af37;
        text-align: center;
        margin-bottom: 2rem;
    }

    /* REPLACE THESE: The New Optimized Mermaid Styles */
    .mermaid {
        background: rgba(10, 10, 10, 0.9);
        padding: 40px; 
        border-radius: 20px;
        border: 3px solid #d4af37;
        overflow-x: auto;
        width: 100%;
        margin: 0 auto;
        box-sizing: border-box;
    }

    .mermaid svg {
        width: 100% !important;
        height: auto !important;
        min-height: 1200px;
    }

    /* Readable text */
    .mermaid .node text {
        font-size: 44px !important;
        font-weight: 600 !important;
    }
    
    /* Legend items - smaller text */
    .mermaid g[id*="flowchart-legend"] .node text,
    .mermaid g[id*="L"] .node text {
        font-size: 40px !important;
    }
    
    .mermaid .edgeLabel {
        background-color: rgba(0, 0, 0, 0.95) !important;
        padding: 10px 16px !important;
        font-size: 30px !important;
        font-weight: 600 !important;
    }

    /* Subgraph titles */
    .cluster-label span {
        font-family: 'PirateFont', Georgia, serif !important;
        font-size: 60px !important;
        color: #d4af37 !important;
        font-weight: bold !important;
        padding: 20px !important;
    }
    
    /* Subgraph backgrounds - transparent/translucent */
    .mermaid .cluster rect {
        fill: rgba(3, 10, 33, 0.3) !important;
    }
    
    /* Hide spacer nodes visually but keep their space */
    .mermaid g[id*="spacer"] rect,
    .mermaid g[id*="spacer_"] rect {
        fill: transparent !important;
        stroke: transparent !important;
    }
    .mermaid g[id*="spacer"] text,
    .mermaid g[id*="spacer_"] text {
        fill: transparent !important;
        opacity: 0 !important;
    }
    
    @media (min-width: 1024px) {
        .mermaid {
            max-width: 1800px;
        }
    }

    </style>
</head>
<body class="system-page">
    <nav>
        <a href="index.html">‚Üê Return to Dashboard</a>
    </nav>
    
    <h1>The Maritime Architecture</h1>
    
    <div class="mermaid">
    graph TB
        Internet[("üåê<br/>Internet<br/>Users")]
        CF[("‚òÅÔ∏è<br/>Cloudflare<br/>CDN")]
        
        subgraph pi4 ["üè¥‚Äç‚ò†Ô∏è<br/>RPi 4<br/>Edge Server"]
            direction LR
            spacer_left["<br/><br/><br/><br/>"]
            Nginx{"‚öì<br/>Nginx<br/>Reverse Proxy<br/>:80/:443"}
            Dashboard["üó∫Ô∏è<br/>Powderchest<br/>Dashboard"]
            spacer_left ~~~ Nginx
        end
        
        subgraph pi5 ["‚õµ<br/>RPi 5<br/>Compute Server"]
            Docker[["üêã<br/>Docker<br/>Engine"]]
            
            subgraph containers ["Containers"]
                MC1["üéÆ<br/>TheStandard<br/>MC Server"]
                MC2["üéÆ<br/>FakeMas0n<br/>MC Server"]
                PH["üõ°Ô∏è<br/>Pi-Hole<br/>DNS Sinkhole"]
                Unbound["üîí<br/>Unbound<br/>DNS Resolver"]
                WG["üîê<br/>WireGuard<br/>VPN Tunnel"]
                Ollama["ü§ñ<br/>Ollama<br/>AI/LLM"]
            end
            
            BMRender["üó∫Ô∏è<br/>BlueMap<br/>Renderer"]
        end
        
        subgraph storage ["üí∞ Network<br/>Storage"]
            spacer_storage["<br/><br/><br/><br/>"]
            SSD[("üíæ<br/>Samba Share<br/>2TB SSD<br/>World Data<br/>Map Tiles<br/>Images")]
        end
        
        subgraph legend ["üìã Key"]
            direction TB
            L1[("External Service")]
            L2{"Network/Proxy"}
            L3["Application"]
            L4[["Orchestrator"]]
            L5[("Storage/Database")]
            L6["‚îÄ‚îÄ‚îÄ Synchronous"]
            L7["‚îÄ ‚îÄ Proxy/Async"]
            L8["‚îÅ‚îÅ‚îÅ Data Flow"]
        end
        
        %% Internet flow
        Internet -->|"HTTPS"|CF
        CF -->|"Protected"|Nginx
        
        %% Nginx routing
        Nginx -->|"Monitors"|Dashboard
        Nginx -.->|"Proxy"|MC1
        Nginx -.->|"Proxy"|MC2
        Nginx -.->|"Serves"|SSD
        Nginx -.->|"Serves"|SSD
        
        %% Docker orchestration
        Docker ==>|"Manages"|MC1
        Docker ==>|"Manages"|MC2
        Docker ==>|"Manages"|PH
        Docker ==>|"Manages"|Unbound
        Docker ==>|"Manages"|WG
        Docker ==>|"Manages"|Ollama
        
        %% Home network services
        PH <-->|"Filters"|Unbound
        Unbound <-->|"Routes"|WG
        
        %% Storage connections
        MC1 <-->|"Read/Write<br/>World Data"|SSD
        MC2 <-->|"Read/Write<br/>World Data"|SSD
        BMRender -->|"Writes<br/>Map Tiles"|SSD
        SSD -->|"Reads<br/>World Data"|BMRender
        
        %% Styling
        classDef cloudStyle fill:#1a1a2e,stroke:#00d4ff,stroke-width:4px,color:#00d4ff,font-weight:bold
        classDef proxyStyle fill:#1a1a2e,stroke:#2ecc71,stroke-width:4px,color:#2ecc71,font-weight:bold
        classDef appStyle fill:#1a1a2e,stroke:#e67e22,stroke-width:3px,color:#e67e22,font-weight:bold
        classDef containerStyle fill:#1a1a2e,stroke:#9b59b6,stroke-width:2px,color:#c39bd3
        classDef storageStyle fill:#1a1a2e,stroke:#d4af37,stroke-width:4px,color:#d4af37,font-weight:bold
        classDef orchestratorStyle fill:#1a1a2e,stroke:#3498db,stroke-width:3px,color:#3498db,font-weight:bold
        classDef legendStyle fill:#1a1a2e,stroke:#555,stroke-width:1px,color:#999,font-size:40px
        
        class Internet,CF cloudStyle
        class Nginx proxyStyle
        class Dashboard,BMRender appStyle
        class Docker orchestratorStyle
        class MC1,MC2,PH,Unbound,WG,Ollama containerStyle
        class SSD storageStyle
        class L1,L2,L3,L4,L5,L6,L7,L8 legendStyle
    </div>
</body>
</html>